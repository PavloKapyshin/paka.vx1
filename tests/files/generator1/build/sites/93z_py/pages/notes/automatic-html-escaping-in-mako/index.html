<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Automatic HTML escaping in Mako ← Notes ← py.93z.org</title><link rel="stylesheet" href="/s/styles.css"><link rel="alternate" type="application/atom+xml" href="/notes/feed/" title="Recent notes from py.93z.org"></head><body><div class="h"><ol class="h-bc"><li><a href="/" rel="home">py.93z.org</a></li><li class="last"><a href="/notes/">Notes</a></li></ol></div><div class="c"><div class="c-i"><div class="c-p"><h1>Automatic HTML escaping in Mako</h1><div class="n-b"><p>Some developers I know think that <a href="http://makotemplates.org/">Mako</a> templating library is “less secure” than, for example, Jinja2 (and, therefore, “must not be used”). Actually, Mako is as “secure” as you’ll configure it.</p><p>Though by default Mako does not HTML-escape rendered expressions, it can be configured to do that. When you create lookup (an instance of <code>mako.lookup.TemplateLookup</code>), you may pass arguments: list of directories to search for templates, encoding of templates, etc. Usually it looks like this:</p><pre><code>import mako.lookup


lookup = mako.lookup.TemplateLookup(
    directories=[os.path.join(..., &quot;templates&quot;)],
    input_encoding=&quot;utf-8&quot;,
    filesystem_checks=False,
    strict_undefined=True)
</code></pre><p>So, how to make lookup, as constructed above, escape rendered expressions? In addition to aforementioned arguments, <code>TemplateLookup</code> accepts <code>default_filters</code>—a list of filters to use on expressions by default:</p><pre><code>import mako.lookup


lookup = mako.lookup.TemplateLookup(
    directories=[os.path.join(..., &quot;templates&quot;)],
    input_encoding=&quot;utf-8&quot;,
    filesystem_checks=False,
    strict_undefined=True,
    default_filters=[&quot;h&quot;])
</code></pre><p>For example, <code>pyramid_mako</code> uses <code>default_filters=[&quot;h&quot;]</code> by default, so if you’re user of Pyramid framework you may have one less thing to worry about.</p><p>Why not <code>default_filters=[&quot;str&quot;, &quot;h&quot;]</code>? It may seem to work, but not for objects with <code>__html__</code> method: these will be treated as text that needs escaping, not HTML that should be rendered as-is. Default filters are applied from left to right, so <code>${form.somefield()}</code> will be transformed, roughly speaking, into <code>h(str(form.somefield()))</code>—which is, basically, <code>h(form.somefield().__str__())</code>. As you can clearly see, <code>form.somefield().__html__</code> will not be called if <code>default_filters</code> are defined as <code>[&quot;str&quot;, &quot;h&quot;]</code>.</p></div></div><div class="c-s"><div class="c-s-s"><h6>Note metadata</h6><dl class="nm-l"><dt>Publication date</dt><dd>January 2, 2017</dd><dt>Tags</dt><dd><ol class="t-l"><li><a href="/tags/mako/">Mako</a></li><li><a href="/tags/pyramid/">Pyramid</a></li></ol></dd></dl></div><div class="c-s-s"><h6>About</h6><p>This is “all things Python” blog &amp; I hope some notes are helpful.</p></div><div class="c-s-s"><h6>Recent notes</h6><ol class="n-l"><li class="a-o"><span class="a">Automatic HTML escaping in Mako</span></li><li><a href="/notes/how-to-create-.tar.gz-reproducibly/">How to create .tar.gz reproducibly (putting it together)</a></li><li><a href="/notes/how-to-create-.gz-reproducibly/">How to create .gz reproducibly</a></li><li><a href="/notes/how-to-create-.tar-reproducibly/">How to create .tar reproducibly</a></li><li><a href="/notes/reproducible-builds-and-django.utils.feedgenerator/">Reproducible builds and django.utils.feedgenerator</a></li><li><a href="/notes/how-to-determine-file-where-particular-function-is-defined/">How to determine file where particular function is defined</a></li><li><a href="/notes/python-m-compatibility/">python -m compatibility</a></li><li><a href="/notes/sort-dict-keys-by-values/">Sort dict’s keys by values</a></li></ol><p><a href="/notes/">All notes</a></p></div></div></div></div><div class="f"><div class="f-i"><div class="f-a"><p>© 2010–2017 py.93z.org</p></div><div class="f-s"><ol class="f-nw"><li><a href="//dev.93z.org">dev.93z.org</a></li><li class="a-o"><a href="/" rel="home" class="a">py.93z.org</a></li></ol></div></div></div><script src="/s/scripts.js" type="text/javascript"></script></body></html>